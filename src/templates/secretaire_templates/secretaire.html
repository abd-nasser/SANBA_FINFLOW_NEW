{% load static %}
{% load tailwind_tags %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>{% block title %}{% endblock title %}</title>
    <link rel="stylesheet" href="{% static 'css/base_style.css' %}">
    <link rel="stylesheet" href="{% static 'css/secretaire_style.css' %}">
    <script src="{% static 'js/htmx.min.js' %}"></script>
    {% tailwind_css %}
    <style>
  
    </style>
</head>
<body>
    <div id="particles"></div>
    <nav>
        <h1>Interface Secr√©taire</h1>
    </nav>
    
    <header>
        
        <h1> SANBA GESTION FINFLOW</h1>
        <h2 class="text-lg font-semibold">Fond disponible: <span class= "font-bold">{{ fond|floatformat:1|intcomma }} FCFA</span></h2>
        <div class="action">
            <div class="right_actions">
                 <a href="{% url 'secretaire_app:hist-demande-decaisse' %}" class="btn btn-hist">
                    üìú Historique des demandes
                </a>
                <a href="{% url 'employee_app:employee-view' %}" class="btn btn-env_rapport">
                    üìã Envoyer un rapport
                </a>
                <button onclick="openClientModal()" class="btn mt-1.5 btn-aj_client">
                    üë§ Nouveau Client
                </button>

            </div>

             <div class='left_actions'>
                <button onclick="openChangeCredentialsModal()" class="btn ch_identifiant">
                    üîê Changer identifiants
                </button>
                <a class="btn deconnexion" href="{% url 'auth_app:logout' %}">
                    D√©connexion
                </a>
            </div>
           
        </div>
        
       
       
    </header>
   
    <main class="container mx-auto px-4 py-6">

          <!-- EN HAUT du template -->
        {% if messages %}
        <div class="messages">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        <h1 class="text-3xl font-bold mb-8 text-center lg:text-left">Tableau de Bord Secr√©taire</h1>
        
        <div class="main-container">
            <!-- SECTION GAUCHE: Liste des demandes -->
            <section class="demande-list-section">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold mb-6 pb-4 border-b-2 border-gray-100">
                        üìã Demandes en cours ({{ list_demande|length }})
                    </h2>
                    
                    {% if list_demande %}
                        <div class="space-y-4">
                            {% for demande in list_demande %}
                            <div class="demande-item">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 class="font-bold text-lg">{{ demande.reference_demande|default:demande.demandeur }}</h3>
                                        <p class="text-sm text-gray-500">Demandeur: {{ demande.demandeur }}</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="font-bold text-xl text-blue-600">{{ demande.montant|floatformat:1|intcomma }} FCFA</span>
                                    </div>
                                </div>
                                
                                {% if demande.chantier %}
                                <p class="mb-2">
                                    <span class="font-semibold">Chantier:</span> 
                                    <span class="bg-gray-100 px-2 py-1 rounded">{{ demande.chantier }}</span>
                                </p>
                                {% endif %}
                                
                                <p class="mb-3">
                                    <span class="font-semibold">Motif:</span> 
                                    <em class="text-gray-700">{{ demande.motif|truncatechars:100 }}</em>
                                </p>
                                
                                <div class="flex justify-between items-center mt-4">
                                    <div>
                                        {% if demande.decaisse %}
                                            <span class="status-badge status-decaisse">D√©caiss√©e</span>
                                        {% elif demande.status == 'approuvee_directeur' or demande.status == 'approuvee_comptable' %}
                                            <span class="status-badge status-approuvee">{{ demande.get_status_display }}</span>
                                            <br>
                                            <br>
                                            <a href="{% url 'secretaire_app:valider-decaissement' demande.id %}" 
                                               class="btn-valider ml-3">
                                                ‚úÖ d√©caisser
                                            </a>
                                           
                                        {% elif demande.status == 'refusee_directeur' or demande.status == 'refusee_comptable' %}
                                            <span class="status-badge status-refusee">{{ demande.get_status_display }}</span>
                                        {% elif demande.status == 'en_attente' %}
                                            <span class="status-badge status-en-attente">{{ demande.get_status_display }}</span>
                                        {% endif %}
                                    </div>
                                    
                                    <div class="text-xs text-gray-500">
                                        Cr√©√©e le: {{ demande.date_demande|date:"d/m/Y" }}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-12">
                            <div class="text-5xl mb-4">üì≠</div>
                            <h3 class="text-xl font-semibold text-gray-500 mb-2">Aucune demande en cours</h3>
                            <p class="text-gray-400">Toutes les demandes ont √©t√© trait√©es</p>
                        </div>
                    {% endif %}
                </div>
            </section>
            
            <!-- SECTION DROITE: Formulaire de demande -->
            <section class="form-section">
                <div class="bg-white rounded-xl shadow-lg p-6 sticky top-6">
                    <h2 class="text-2xl font-bold mb-6 pb-4 border-b-2 border-gray-100">
                        üìù Nouvelle demande de d√©caissement
                    </h2>
                    
                    <form action="{% url 'secretaire_app:secretaire-view' %}" method="post" class="space-y-5">
                        {% csrf_token %}
                        
                        <!-- Champs cach√©s -->
                        {% for field in dmd_form.hidden_fields %}
                            {{ field }}
                        {% endfor %}
                        
                        <div class="form-grid">
                            <!-- R√©f√©rence demande -->
                            <div class="form-full-width">
                                <label class="label" for="{{ dmd_form.reference_demande.id_for_label }}">
                                    <span class="label-text font-semibold">R√©f√©rence de la demande</span>
                                    <span class="label-text-alt text-error">*</span>
                                </label>
                                {{ dmd_form.reference_demande }}
                                {% if dmd_form.reference_demande.errors %}
                                    <label class="label">
                                        {% for error in dmd_form.reference_demande.errors %}
                                            <span class="label-text-alt text-error">{{ error }}</span>
                                        {% endfor %}
                                    </label>
                                {% endif %}
                            </div>
                            
                            <!-- Demandeur -->
                            <div class="form-control">
                                <label class="label" for="{{ dmd_form.demandeur.id_for_label }}">
                                    <span class="label-text font-semibold">Demandeur</span>
                                </label>
                                {{ dmd_form.demandeur }}
                                {% if dmd_form.demandeur.errors %}
                                    <label class="label">
                                        {% for error in dmd_form.demandeur.errors %}
                                            <span class="label-text-alt text-error">{{ error }}</span>
                                        {% endfor %}
                                    </label>
                                {% endif %}
                            </div>
                            
                            <!-- Montant -->
                            <div class="form-control">
                                <label class="label" for="{{ dmd_form.montant.id_for_label }}">
                                    <span class="label-text font-semibold">Montant (FCFA)</span>
                                </label>
                                {{ dmd_form.montant}}
                                {% if dmd_form.montant.errors %}
                                    <label class="label">
                                        {% for error in dmd_form.montant.errors %}
                                            <span class="label-text-alt text-error">{{ error }}</span>
                                        {% endfor %}
                                    </label>
                                {% endif %}
                            </div>
                            
                            <!-- Chantier -->
                            <div class="form-control">
                                <label class="label" for="{{ dmd_form.chantier.id_for_label }}">
                                    <span class="label-text font-semibold">Chantier</span>
                                    <span class="label-text-alt text-gray-500">Optionnel</span>
                                </label>
                                {{ dmd_form.chantier }}
                                {% if dmd_form.chantier.errors %}
                                    <label class="label">
                                        {% for error in dmd_form.chantier.errors %}
                                            <span class="label-text-alt text-error">{{ error }}</span>
                                        {% endfor %}
                                    </label>
                                {% endif %}
                            </div>
                            
                            <!-- Motif (pleine largeur) -->
                            <div class="form-full-width mb-4">
                                <label class="label" for="{{ dmd_form.motif.id_for_label }}">
                                    <span class="label-text font-semibold">Motif</span>
                                    <span class="label-text-alt text-error">*</span>
                                </label>
                                {{ dmd_form.motif }}
                                {% if dmd_form.motif.errors %}
                                    <label class="label">
                                        {% for error in dmd_form.motif.errors %}
                                            <span class="label-text-alt text-error">{{ error }}</span>
                                        {% endfor %}
                                    </label>
                                {% endif %}
                                <label class="label">
                                    <span class="label-text-alt text-gray-500">D√©crivez en d√©tail le motif de la demande</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Bouton de soumission -->
                        <div class="form-control  pt-4">
                            <button type="submit" class="btn mt-5 btn-dmd btn-lg w-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                </svg>
                                Soumettre la demande de d√©caissement
                            </button>
                            <p class="text-center text-sm text-gray-500 mt-2">
                                La demande sera soumise pour approbation
                            </p>
                        </div>
                    </form>
                    
                    <!-- Indicateur de fonds disponibles -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                        <div class="flex items-center">
                            <div class="mr-3 text-blue-600">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div>
                                <h4 class="font-bold text-blue-700">Fonds disponibles</h4>
                                <p class="text-2xl font-bold text-blue-800">{{ fond }} FCFA</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
                <!-- Footer -->
<footer class="bg-gray-900 text-white mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="font-bold text-lg">SANBA GESTION FINFLOW</p>
                    <p class="text-gray-400 text-sm"> Interface-S√©cretaire</p>
                </div>
                
                <div class="text-center md:text-right">
                    <p class="text-gray-400">¬© {% now "Y" %} - Tous droits r√©serv√©s</p>
                    <p class="text-gray-500 text-sm mt-1">
                        G√©n√©r√© le {% now "d/m/Y √† H:i" %}
                    </p>
                </div>
            </div>
        </div>
</footer>

    <script>
        function openChangeCredentialsModal() {
            document.getElementById('changeCredentialsModal').showModal();
            document.getElementById('new_username').focus();
        }

        function togglePassword(fieldId) {
            const field = document.querySelector(`[name="${fieldId}"]`);
            const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
            field.setAttribute('type', type);
        }
        
        function openClientModal() {
            document.getElementById('clientModal').showModal();
        }

         document.addEventListener('DOMContentLoaded', function() {
        const particlesContainer = document.getElementById('particles');
        
        // Cr√©er des particules color√©es selon le gradient
        for (let i = 0; i < 25; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            // Position al√©atoire
            particle.style.left = Math.random() * 100 + 'vw';
            particle.style.top = Math.random() * 100 + 'vh';
            
            // Taille al√©atoire
            const size = Math.random() * 5 + 1;
            particle.style.width = size + 'px';
            particle.style.height = size + 'px';
            
            // Couleur bas√©e sur la position (pour suivre le gradient)
            const hue = Math.random() * 360;
            particle.style.backgroundColor = `hsla(${hue}, 70%, 70%, 0.3)`;
            
            // Animation al√©atoire
            particle.style.animationDuration = Math.random() * 25 + 15 + 's';
            particle.style.animationDelay = Math.random() * 5 + 's';
            
            particlesContainer.appendChild(particle);
        }
        
        {% if open_login_modal %}
        setTimeout(() => {
            openLoginModal();
        }, 1000);
        {% endif %}
    });

    </script>

    {% if open_change_id %}
    <script>
        document.addEventListener("DOMContentLoaded", function(){
            openChangeCredentialsModal();
        });
    </script>
    {% endif %}
    
    {% include 'auth_templates/changer_id.html' %}
    {% include 'modal/ajouter_client.html' %}
</body>
</html>




    
    