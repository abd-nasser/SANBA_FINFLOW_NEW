<dialog id="paiementModal" class="modal">
  <div class="modal-box max-w-md">
    
    <!-- En-tête -->
    <div class="text-center mb-6">
      <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-green-100 mb-3">
        <svg style="width: 24px; height: 24px;" fill="none" stroke="#16a34a" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <h3 class="text-2xl font-bold text-gray-900">Nouveau paiement</h3>
      <p class="text-sm text-gray-600">Contrat: {{ contrat.reference_contrat }}</p>
    </div>

    <!-- Informations du contrat -->
    <div class="bg-blue-50 rounded-lg p-4 mb-6">
      <div class="grid grid-cols-2 gap-2 text-sm">
        <div>
          <span class="font-medium text-gray-600">Montant total:</span>
          <p class="font-bold">{{ contrat.montant_total|floatformat:2 }} FCFA</p>
        </div>
        <div>
          <span class="font-medium text-gray-600">Déjà payé:</span>
          <p class="font-bold">{{ contrat.montant_encaisse|floatformat:2 }} FCFA</p>
        </div>
        <div class="col-span-2">
          <span class="font-medium text-gray-600">Solde restant:</span>
          <p class="font-bold text-green-600">{{ contrat.solde_restant|floatformat:2 }} FCFA</p>
        </div>
      </div>
      
      <!-- Barre de progression -->
      <div class="mt-3">
        <div class="flex justify-between text-xs mb-1">
          <span>Progression</span>
          <span>{{ contrat.pourcentage_encaisse|floatformat:1 }}%</span>
        </div>
        <progress class="progress progress-primary w-full h-2" 
                  value="{{ contrat.pourcentage_encaisse|floatformat:1 }}" 
                  max="100"></progress>
      </div>
    </div>

    <!-- Formulaire -->
    <form method="post" action="{% url 'contrat_app:nouveau-paiement' contrat.id %}" class="space-y-4">
      {% csrf_token %}
      
      <!-- Montant -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-bold">Montant du paiement (FCFA)</span>
        </label>
        <div class="relative">
          <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">FCFA</span>
          <input type="number" 
                 name="nouveau-paiement" 
                 id="nouveau-paiement"
                 class="input input-bordered w-full pl-14 text-lg"
                 placeholder="0.00"
                 required>
        </div>
        <div class="text-xs text-gray-500 mt-1">
          Maximum possible: {{ contrat.solde_restant }} FCFA
        </div>
      </div>

      <!-- Type de paiement -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-bold">Mode de paiement</span>
        </label>
        <select name="mode_paiement" class="select select-bordered w-full">
          <option value="espece">Espèces</option>
          <option value="virement">Virement bancaire</option>
          <option value="cheque">Chèque</option>
          <option value="mobile_money">Mobile Money</option>
          <option value="autre">Autre</option>
        </select>
      </div>

      <!-- Référence -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-bold">Référence/N° de transaction</span>
        </label>
        <input type="text" 
               name="reference" 
               class="input input-bordered w-full"
               placeholder="Ex: VIR-123456, CHQ-789">
      </div>

      <!-- Notes -->
      <div class="form-control">
        <label class="label">
          <span class="label-text font-bold">Notes (optionnel)</span>
        </label>
        <textarea name="notes" 
                  class="textarea textarea-bordered h-20" 
                  placeholder="Informations supplémentaires sur ce paiement..."></textarea>
      </div>

      <!-- Confirmation -->
      <div class="form-control">
        <label class="label cursor-pointer justify-start gap-3">
          <input type="checkbox" class="checkbox checkbox-primary" required>
          <span class="label-text">Je confirme la réception de ce paiement</span>
        </label>
      </div>

      <!-- Boutons -->
      <div class="modal-action">
        <button type="button" onclick="paiementModal.close()" class="btn btn-ghost">
          Annuler
        </button>
        <button type="submit" class="btn btn-success">
          <svg style="width: 20px; height: 20px;" class="mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          Enregistrer le paiement
        </button>
      </div>
    </form>
  </div>
  
  <!-- Backdrop -->
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>

<!-- Script pour ouvrir -->
<script>
function openPaiementModal() {
  document.getElementById('paiementModal').showModal();
}
</script>
