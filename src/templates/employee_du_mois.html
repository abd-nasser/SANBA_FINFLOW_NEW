{% load static %}
{% load tailwind_tags %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Meilleurs Employ√©s du Mois</title>
    <link rel="stylesheet" href="{% static 'css/employe_du_mois_style.css' %}">
    <!-- DaisyUI via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.1.6/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js pour les graphiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome pour les ic√¥nes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/employe_du_mois_style.css' %}">
    {% tailwind_css %}
    
</head>
<body class="bg-gradient-to-br body  from-blue-50 to-indigo-100 min-h-screen">
    <div class="container dash_container mx-auto p-4 md:p-8">
        
    
        <header class="mb-10 text-center">
            <div class="flex items-center justify-center gap-4 mb-4">
                <i class="fas fa-trophy text-5xl text-yellow-500"></i>
                <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-white to-gray-500 to-black bg-clip-text text-transparent">
                    üèÜ Meilleurs Employ√©s du Mois
                </h1>
                <i class="fas fa-medal text-5xl text-yellow-500"></i>
            </div>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                D√©couvrez les performances exceptionnelles de nos collaborateurs ce mois-ci
            </p>
            <div class="badge badge-lg badge-success mt-4 gap-2">
                <i class="fas fa-calendar-alt"></i>
                {{ timezone.now|date:"F Y" }}
            </div>
        </header>

        <!-- Section 1: Tableau de classement principal -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6 text-center flex items-center justify-center gap-3">
                <i class="fas fa-crown text-yellow-500"></i>
                Classement G√©n√©ral
                <i class="fas fa-crown text-yellow-500"></i>
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                
                <!-- Carte GOLD - Meilleur commercial -->
                {% if top_commerciaux %}
                <div class="card">
                    <div class="card-body items-center text-center">
                        <div class="badge badge-gold badge-lg mb-4 p-4 rounded-full">
                            <i class="fas fa-crown text-2xl"></i>
                        </div>
                        <h3 class="card-title text-2xl mb-2">ü•á Meilleur Commercial</h3>
                        
                        {% for commercial in top_commerciaux %}
                        <div class="avatar mb-4">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-r from-yellow-400 to-amber-500 p-1">
                                <div class="w-full h-full rounded-full bg-white flex items-center justify-center">
                                    <i class="fas fa-user-tie text-4xl text-amber-600"></i>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="text-xl font-bold mb-2">{{ commercial.username|default:"Commercial" }}</h4>
                        
                        <div class="stats stats-vertical bg-transparent shadow-none w-full">
                            <div class="stat">
                                <div class="stat-title">CA G√©n√©r√©</div>
                                <div class="stat-value text-success">
                                    {{ commercial.ca_genere|default:0|floatformat:2 }} FCFA
                                </div>
                                <div class="stat-desc">
                                    <i class="fas fa-chart-line text-success"></i> +15% vs mois dernier
                                </div>
                            </div>
                            
                            <div class="stat">
                                <div class="stat-title">Clients Apport√©s</div>
                                <div class="stat-value">{{ commercial.clients_amenes|default:0 }}</div>
                            </div>
                            
                            <div class="stat">
                                <div class="stat-title">Contrats Sign√©s</div>
                                <div class="stat-value">{{ commercial.contrats_signes|default:0 }}</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Carte SILVER - Plus de d√©penses valid√©es -->
                {% if total_depense_employee %}
                <div class="card">
                    <div class="card-body items-center text-center">
                        <div class="badge badge-silver badge-lg mb-4 p-4 rounded-full">
                            <i class="fas fa-medal text-2xl"></i>
                        </div>
                        <h3 class="card-title text-2xl mb-2">ü•à D√©penses Valid√©es</h3>
                        
                        {% for depense in total_depense_employee|slice:1 %}
                        <div class="avatar mb-4">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-r from-gray-400 to-slate-600 p-1">
                                <div class="w-full h-full rounded-full bg-white flex items-center justify-center">
                                    <i class="fas fa-money-bill-wave text-4xl text-slate-600"></i>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="text-xl font-bold mb-2">{{ depense.employee__username|default:"Employ√©" }}</h4>
                        
                        <div class="stats stats-vertical bg-transparent shadow-none w-full">
                            <div class="stat">
                                <div class="stat-title">Total D√©penses</div>
                                <div class="stat-value text-primary">
                                    {{ depense.total_depense|default:0|floatformat:2 }} FCFA
                                </div>
                                <div class="stat-desc">D√©penses valid√©es ce mois</div>
                            </div>
                            
                            <div class="stat">
                                <div class="stat-title">Activit√©</div>
                                <div class="stat-value">üí∞</div>
                                <div class="stat-desc">Gestion des d√©penses</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Carte BRONZE - Plus de rapports -->
                {% if rapports_employee %}
                <div class="card">
                    <div class="card-body items-center text-center">
                        <div class="badge badge-bronze badge-lg mb-4 p-4 rounded-full">
                            <i class="fas fa-award text-2xl"></i>
                        </div>
                        <h3 class="card-title text-2xl mb-2">ü•â Plus de Rapports</h3>
                        
                        {% for rapport in rapports_employee|slice:1 %}
                        <div class="avatar mb-4">
                            <div class="w-24 h-24 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 p-1">
                                <div class="w-full h-full rounded-full bg-white flex items-center justify-center">
                                    <i class="fas fa-file-alt text-4xl text-orange-600"></i>
                                </div>
                            </div>
                        </div>
                        
                        <h4 class="text-xl font-bold mb-2">{{ rapport.employee__username|default:"Employ√©" }}</h4>
                        
                        <div class="stats stats-vertical bg-transparent shadow-none w-full">
                            <div class="stat">
                                <div class="stat-title">Rapports Soumis</div>
                                <div class="stat-value text-secondary">{{ rapport.total_rapports|default:0 }}</div>
                                <div class="stat-desc">Ce mois-ci</div>
                            </div>
                            
                            <div class="stat">
                                <div class="stat-title">Productivit√©</div>
                                <div class="stat-value">üìä</div>
                                <div class="stat-desc">Excellente r√©gularit√©</div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </section>

        <!-- Section 2: Graphiques de performance -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-8 text-center">
                <i class="fas fa-chart-bar text-blue-500 mr-3"></i>
                Visualisation des Performances
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Graphique 1: Comparaison des d√©penses -->
                <div class="card">
                    <div class="card-body">
                        <h3 class="card-title mb-4">
                            <i class="fas fa-money-bill-trend-up text-green-500"></i>
                            D√©penses par Employ√©
                        </h3>
                        <div class="chart-container">
                            <canvas id="depensesChart"></canvas>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">
                            <i class="fas fa-lightbulb text-yellow-500"></i>
                            Ce graphique montre qui a g√©r√© le plus de d√©penses ce mois-ci.
                        </p>
                    </div>
                </div>
                
                <!-- Graphique 2: Rapports soumis -->
                <div class="card">
                    <div class="card-body">
                        <h3 class="card-title mb-4">
                            <i class="fas fa-file-circle-check text-blue-500"></i>
                            Rapports Soumis
                        </h3>
                        <div class="chart-container">
                            <canvas id="rapportsChart"></canvas>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">
                            <i class="fas fa-lightbulb text-yellow-500"></i>
                            Nombre de rapports soumis par chaque employ√©.
                        </p>
                    </div>
                </div>
                
                <!-- Graphique 3: Performance commerciale 
                <div class="card">
                    <div class="card-body">
                        <h3 class="card-title mb-4">
                            <i class="fas fa-chart-pie text-purple-500"></i>
                            Performance Commerciale D√©tail
                        </h3>
                        <div class="chart-container" style="height: 400px;">
                            <canvas id="performanceChart"></canvas>
                        </div>
                        <p class="text-sm text-gray-500 mt-4">
                            <i class="fas fa-lightbulb text-yellow-500"></i>
                            D√©tail des performances des commerciaux : CA, clients, contrats.
                        </p>
                    </div>
                </div>
            </div>-->
        </section>

        <!-- Section 3: Tableau d√©taill√© -->
        <section class="mb-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title text-2xl mb-6">
                        <i class="fas fa-table text-indigo-500"></i>
                        D√©tails des Performances
                    </h3>
                    
                    <div class="overflow-x-auto">
                        <table class="table table-zebra w-full">
                            <thead>
                                <tr class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white">
                                    <th>üèÜ Classement</th>
                                    <th>üë§ Employ√©</th>
                                    <th>üí∞ D√©penses Valid√©es</th>
                                    <th>üìä Rapports Soumis</th>
                                    <th>üìà Performance</th>
                                    <th>üèÖ Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for commercial in top_commerciaux %}
                                <tr>
                                    <td>
                                        <div class="badge badge-gold gap-2">
                                            <i class="fas fa-trophy"></i> 1er
                                        </div>
                                    </td>
                                    <td>
                                        <div class="flex items-center gap-3">
                                            <div class="avatar">
                                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-400 to-amber-500 flex items-center justify-center">
                                                    <i class="fas fa-user-tie text-white"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="font-bold">{{ commercial.username|default:"Commercial" }}</div>
                                                <div class="text-sm opacity-50">Commercial</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>-</td>
                                    <td>-</td>
                                    <td>
                                        <div class="flex flex-col">
                                            <span>CA: {{ commercial.ca_genere|default:0|floatformat:2 }}‚Ç¨</span>
                                            <span class="text-sm">Clients: {{ commercial.clients_amenes|default:0 }}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="radial-progress text-yellow-500" 
                                             style="--value:95; --size:3rem; --thickness: 4px;">
                                            95%
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                                
                                {% for depense in total_depense_employee %}
                                <tr>
                                    <td>
                                        <div class="badge badge-silver gap-2">
                                            <i class="fas fa-medal"></i> 2√®me
                                        </div>
                                    </td>
                                    <td>
                                        <div class="flex items-center gap-3">
                                            <div class="avatar">
                                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-gray-400 to-slate-600 flex items-center justify-center">
                                                    <i class="fas fa-user-cog text-white"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="font-bold">{{ depense.employee__username|default:"Employ√©" }}</div>
                                                <div class="text-sm opacity-50">Gestionnaire</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-success font-bold">
                                        {{ depense.total_depense|default:0|floatformat:2 }}‚Ç¨
                                    </td>
                                    <td>-</td>
                                    <td>D√©penses valid√©es</td>
                                    <td>
                                        <div class="radial-progress text-gray-500" 
                                             style="--value:85; --size:3rem; --thickness: 4px;">
                                            85%
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                                
                                {% for rapport in rapports_employee %}
                                <tr>
                                    <td>
                                        <div class="badge badge-bronze gap-2">
                                            <i class="fas fa-award"></i> 3√®me
                                        </div>
                                    </td>
                                    <td>
                                        <div class="flex items-center gap-3">
                                            <div class="avatar">
                                                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-amber-400 to-orange-500 flex items-center justify-center">
                                                    <i class="fas fa-user-edit text-white"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="font-bold">{{ rapport.employee__username|default:"Employ√©" }}</div>
                                                <div class="text-sm opacity-50">Administratif</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>-</td>
                                    <td class="text-info font-bold">{{ rapport.total_rapports|default:0 }}</td>
                                    <td>Productivit√© rapports</td>
                                    <td>
                                        <div class="radial-progress text-orange-500" 
                                             style="--value:80; --size:3rem; --thickness: 4px;">
                                            80%
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
   

        <!-- Section 4: Commentaires et f√©licitations -->
        <section class="mb-8">
            <div class="card">
                <div class="card-body text-center">
                    <h3 class="card-title text-2xl justify-center mb-4">
                        <i class="fas fa-comment-medical text-blue-500"></i>
                        F√©licitations et Commentaires
                    </h3>
                    <p class="text-lg mb-4">
                        <i class="fas fa-quote-left text-blue-300 text-2xl align-top mr-2"></i>
                        Bravo √† tous nos employ√©s pour leurs efforts ce mois-ci ! 
                        Votre travail est essentiel pour notre r√©ussite collective.
                        <i class="fas fa-quote-right text-blue-300 text-2xl align-top ml-2"></i>
                    </p>
                    <div class="flex flex-wrap justify-center gap-4 mt-6">
                        <div class="badge badge-lg badge-success gap-2">
                            <i class="fas fa-star"></i> Excellence
                        </div>
                        <div class="badge badge-lg badge-info gap-2">
                            <i class="fas fa-rocket"></i> Progression
                        </div>
                        <div class="badge badge-lg badge-warning gap-2">
                            <i class="fas fa-bullseye"></i> Objectifs
                        </div>
                        <div class="badge badge-lg badge-primary gap-2">
                            <i class="fas fa-handshake"></i> Collaboration
                        </div>
                    </div>
                </div>
            </div>
        </section>
           
            {% if user.is_authenticated and user.post.nom == 'Directeur' %}
                 <a href="{% url 'directeur_app:directeur-view' %}" class="btn btn-sm btn-outline-primary float-end">
                <i class="fas fa-arrow-left"></i> Retour au Dashboard
                 </a>
                {% elif user.is_authenticated and user.post.nom == 'Comptable' %}
                 <a href="{% url 'comptable_app:comptable-view' %}" class="btn btn-sm btn-outline-primary float-end">
                <i class="fas fa-arrow-left"></i> Retour au Dashboard
                 </a>
                 {% elif user.is_authenticated and user.post.nom == 'S√©cretaire' %}
                 <a href="{% url 'secretaire_app:secretaire-view' %}" class="btn btn-sm btn-outline-primary float-end">
                <i class="fas fa-arrow-left"></i> Retour au Dashboard
                 </a>
                    {% elif user.is_authenticated and user.post.nom == 'Employ√©' %}
                    <a href="{% url 'employee_app:employee-view' %}" class="btn btn-sm btn-outline-primary float-end">
                <i class="fas fa-arrow-left"></i> Retour au Dashboard
                 </a>
            {% endif %}
                
       
        <!-- Pied de page -->
        <footer class="text-center text-gray-500 text-sm mt-12 pt-8 border-t">
            <p>
                <i class="fas fa-sync-alt mr-2"></i>
                Mise √† jour automatique - Donn√©es du mois de {{ timezone.now|date:"F Y" }}
            </p>
            <p class="mt-2">
                ¬© {% now "Y" %} SANBA FINFLOW - Tableau des performances
            </p>
        </footer>
    </div>

    <!-- JavaScript pour les graphiques -->
    <script>
        // üéØ ATTENTION C'EST ICI QUE √áA SE PASSE ! 
        // On va cr√©er des dessins color√©s avec les chiffres (graphiques)
        
        // ============================================
        // 1. GRAPHIQUE DES D√âPENSES
        // ============================================
        // On r√©cup√®re la bo√Æte √† dessin (canvas) qui s'appelle "depensesChart"
        const depensesCtx = document.getElementById('depensesChart').getContext('2d');
        
        // On cr√©e le graphique avec des couleurs
        const depensesChart = new Chart(depensesCtx, {
            type: 'bar',  // Type de graphique : barres verticales
            data: {
                // Noms des personnes en bas du graphique
                labels: [
                    {% for depense in total_depense_employee %}
                    '{{ depense.employee__username|default:"Employ√©" }}',
                    {% endfor %}
                    {% for rapport in rapports_employee %}
                    '{{ rapport.employee__username|default:"Employ√©" }}',
                    {% endfor %}
                    
                ],
                datasets: [{
                    label: 'üí∞ Montant en FCFA',  // Petite l√©gende
                    // Les chiffres √† afficher (exemple, tu peux les remplacer)
                    data: [
                        {% for depense in total_depense_employee %}
                        {{ depense.total_depense|default:0 }},
                        {% endfor %}
                    ],
                    backgroundColor: [
                        '#FBBF24',  // Jaune pour le 1er
                        '#9CA3AF',  // Gris pour le 2√®me  
                        '#FB923C',  // Orange pour le 3√®me
                    
                    ],
                    borderColor: '#1E40AF',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',  // La l√©gende en haut
                    },
                    title: {
                        display: true,
                        text: 'Qui a d√©pens√© le plus d\'argent ce mois-ci ?'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,  // Commence √† 0
                        ticks: {
                            callback: function(value) {
                                return value + ' FCFA';  // Ajoute le signe FCFA
                            }
                        }
                    }
                }
            }
        });
        
        // ============================================
        // 2. GRAPHIQUE DES RAPPORTS
        // ============================================
        // M√™me chose pour le 2√®me graphique
        const rapportsCtx = document.getElementById('rapportsChart').getContext('2d');
        const rapportsChart = new Chart(rapportsCtx, {
            type: 'doughnut',  // Graphique en forme de donut (beignet)
            data: {
                labels: [
                    {% for rapport in rapports_employee %}
                    '{{ rapport.employee__username|default:"Employ√©" }}',
                    {% endfor %}
                    
                ],
                datasets: [{
                    label: 'üìä Nombre de rapports',
                    data: [
                        {% for rapport in rapports_employee|slice:5 %}
                        {{ rapport.total_rapports|default:0 }},
                        {% endfor %}
                
                    ],
                    backgroundColor: [
                        '#FB923C',  // Orange
                        '#60A5FA',  // Bleu clair
                        '#A78BFA',  // Violet
                        '#34D399',   // Vert
                        '#E67977',   //hamonie
                    ],
                    borderWidth: 3,
                    borderColor: '#FFFFFF'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',  // L√©gende √† droite
                    },
                    title: {
                        display: true,
                        text: 'R√©partition des rapports soumis'
                    }
                }
            }
        });
        
        // ============================================
        // 3. GRAPHIQUE DE PERFORMANCE D√âTAILL√â
        // ============================================
        // Un dernier graphique plus complet

        // const performanceCtx = document.getElementById('performanceChart').getContext('2d');
        // const performanceChart = new Chart(performanceCtx, {
        //     type: 'radar',  // Graphique en forme d'√©toile/radar
        //     data: {
        //         labels: ['CA G√©n√©r√©', 'Clients', 'Contrats', 'D√©penses', 'Rapports', 'Satisfaction'],
        //         datasets: [
        //            {
        //                label: 'Top Commercial',
        //                data: [90, 85, 95, 70, 80, 90],
        //                backgroundColor: 'rgba(251, 191, 36, 0.2)',
        //                borderColor: '#FBBF24',
        //                borderWidth: 3       },
       //             {
        //                label: 'Top D√©penses',
        //                 data: [60, 70, 65, 95, 75, 80],
        //                backgroundColor: 'rgba(156, 163, 175, 0.2)',
        //                borderColor: '#9CA3AF',
        //                borderWidth: 3
        //            },
        //            {
        //                label: 'Top Rapports',
        //                data: [70, 65, 70, 75, 95, 85],
        //                backgroundColor: 'rgba(251, 146, 60, 0.2)',
        //                borderColor: '#FB923C',
        //                borderWidth: 3
         //           }
         //         ]
          //  },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'Comparaison des forces de chaque employ√©'
                    },
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            stepSize: 20
                        }
                    }
                }
            }
      //  });
        
        // ============================================
        // PETIT BONUS : Animation des scores
        // ============================================
        // Quand on clique sur un graphique, on le fait grossir
        document.querySelectorAll('canvas').forEach(canvas => {
            canvas.addEventListener('click', function() {
                this.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 300);
            });
        });
        
        // Message de chargement r√©ussi
        console.log('üé® Les graphiques sont pr√™ts !');
        console.log('üìä Tu peux voir :');
        console.log('1. Un graphique en barres pour les d√©penses');
        console.log('2. Un graphique en donut pour les rapports');
        console.log('3. Un graphique radar pour comparer tout le monde');
    </script>
</body>
</html>