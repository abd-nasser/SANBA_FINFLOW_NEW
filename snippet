# 1. Supprime complÃ¨tement la base de donnÃ©es
rm db.sqlite3

# 2. Supprime TOUS les fichiers de migrations
find . -path "*/migrations/*.py" -not -name "__init__.py" -delete
find . -path "*/migrations/*.pyc" -delete

# 3. RecrÃ©e tout depuis zÃ©ro
python manage.py makemigrations
python manage.py migrate

# 4. Superuser
python manage.py createsuperuser


#----------------------------------------------------------------------------------------------------------------------------
# Script universel qui dÃ©tecte le moteur de base de donnÃ©es
from django.db import connection
import sqlite3
import os

def reset_database_sequences():
    """ğŸ¯ RÃ©initialise toutes les sÃ©quences selon le moteur DB"""
    
    db_engine = connection.vendor
    print(f"ğŸ”§ Moteur de base dÃ©tectÃ©: {db_engine}")
    
    if db_engine == 'sqlite':
        reset_sqlite_sequences()
    elif db_engine == 'postgresql':
        reset_postgresql_sequences()
    elif db_engine == 'mysql':
        reset_mysql_sequences()
    else:
        print(f"âŒ Moteur {db_engine} non supportÃ©")

def reset_sqlite_sequences():
    """ğŸ—‘ï¸ Nettoie SQLite complÃ¨tement"""
    db_path = 'db.sqlite3'
    if os.path.exists(db_path):
        os.remove(db_path)
        print("âœ… db.sqlite3 supprimÃ© - RecrÃ©ez avec: python manage.py migrate")
    else:
        print("â„¹ï¸ db.sqlite3 n'existe pas dÃ©jÃ ")

def reset_postgresql_sequences():
    """ğŸ”„ RÃ©initialise les sÃ©quences PostgreSQL"""
    with connection.cursor() as cursor:
        # RÃ©initialiser toutes les sÃ©quences
        cursor.execute("""
            SELECT c.relname
            FROM pg_class c
            WHERE c.relkind = 'S'
        """)
        sequences = [row[0] for row in cursor.fetchall()]
        
        for seq in sequences:
            cursor.execute(f"ALTER SEQUENCE {seq} RESTART WITH 1;")
            print(f"âœ… {seq} rÃ©initialisÃ©e")
        
        print(f"ğŸ‰ {len(sequences)} sÃ©quences PostgreSQL rÃ©initialisÃ©es")

def reset_mysql_sequences():
    """ğŸ”„ RÃ©initialise les AUTO_INCREMENT MySQL"""
    with connection.cursor() as cursor:
        cursor.execute("SHOW TABLES;")
        tables = [row[0] for row in cursor.fetchall()]
        
        for table in tables:
            cursor.execute(f"ALTER TABLE {table} AUTO_INCREMENT = 1;")
            print(f"âœ… {table} rÃ©initialisÃ©")
        
        print(f"ğŸ‰ {len(tables)} tables MySQL rÃ©initialisÃ©es")

# ğŸš€ EXÃ‰CUTION
if __name__ == "__main__":
    reset_database_sequences()