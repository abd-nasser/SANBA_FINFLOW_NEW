{% load static %}
{% load tailwind_tags %}
{% load humanize %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Contrat D√©coration - {{ contrat.reference_contrat }}</title>
     <script src="{% static 'js/htmx.min.js' %}"></script>
    <style>
        /* Styles pour √©cran */
         body {
            font-family: Arial, sans-serif;
            margin: 40px;
            line-height: 1.6;
        }

        .screen-only {
            background: url('{% static "images/logo_deco.png" %}');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        header {
            text-align: center;
            padding-bottom: 20px;
            margin-bottom: 30px;
            border-bottom: 3px solid #C91A1A;
        }
        
        .logo {
            width: 100%;
            height: 35vh;
            margin: 0 auto 20px;
            object-fit: cover;
        }
        
        h1 {
            color: #C91A1A;
            margin-bottom: 5px;
        }
        
        h2 {
            color: #666;
            font-weight: normal;
            margin-bottom: 10px;
        }
        
        section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #C91A1A;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(8px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        h3 {
            color: #C91A1A;
            border-bottom: 2px solid #C91A1A;
            padding-bottom: 8px;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        p {
            margin: 10px 0;
            color: #333;
        }
        
        strong {
            color: #000;
        }
        
        .payment-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: #C91A1A;
            color: white !important;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none !important;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .payment-link:hover {
            background: #A81515;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(201, 26, 26, 0.3);
        }



        button {
    display: flex;
    margin: 50px auto;
    padding: 16px 32px;
    background: linear-gradient(135deg, #C91A1A, #A81515);
    color: white;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 6px 15px rgba(201, 26, 26, 0.4);
    transition: all 0.3s ease;
    min-height: 3rem;
    align-items: center;
}
        
        button:hover {
            background: #A81515;
            transform: translateY(-2px);
            transition: all 0.2s ease;
        }
        
        footer {
            margin-top: 60px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px dashed #C91A1A;
            border-radius: 10px;
        }
        
        .signatures {
            display: flex;
            justify-content: space-around;
            margin-top: 40px;
        }
        
        .signature-box {
            text-align: center;
        }
        
        .signature-line {
            width: 250px;
            height: 2px;
            background: #000;
            margin: 60px auto 10px;
        }
        
        /* Styles pour IMPRESSION */
        @media print {
            button, .no-print {
                display: none !important;
            }
            
            button, .payment-link, a {
                display: none !important;
            }


            body {
                margin: 20px !important;
                background: white !important;
                background-image: none !important;
            }
            
            /* Supprime les effets pour impression */
            section {
                background: white !important;
                border: 1px solid #ccc !important;
                border-radius: 0 !important;
                backdrop-filter: none !important;
                box-shadow: none !important;
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            /* Header optimis√© pour impression */
            header {
                border-bottom: 3px solid #000 !important;
            }
            
            .logo {
                width: 150px !important;
                height: auto !important;
            }
            
            /* Am√©liore la lisibilit√© */
            h1, h2, h3 {
                color: #000 !important;
                page-break-after: avoid;
            }
            
            h3 {
                border-bottom: 2px solid #000 !important;
            }
            
            p {
                color: #000 !important;
                page-break-inside: avoid;
            }
            
            /* Footer pour impression */
            footer {
                background: white !important;
                border: 1px solid #000 !important;
                margin-top: 80px !important;
                page-break-before: always;
            }
            
            .signature-line {
                background: #000 !important;
                margin: 50px auto 10px !important;
            }
            
            /* √âvite les coupures */
            section:last-child {
                page-break-after: avoid;
            }
        }
    </style>
    {% tailwind_css %}
</head>
<body class="screen-only">
    <header>
        <img src="{% static 'images/en_tete.jpg' %}" alt="En-t√™te" class="logo">
        <h1>CONTRAT DE D√âCORATION INT√âRIEURE</h1>
        <h2>R√©f√©rence : {{ contrat.reference_contrat }}</h2>
        <p><strong>Date :</strong> {{ contrat.date_signature|date:"d/m/Y"|default:"Non sign√©" }}</p>
    </header>
    
    <main>
        <section>
            <h3>DESCRIPTIF DES TRAVAUX</h3>
            <p><strong>Client :</strong> {{ contrat.chantier.client.nom_complet }}</p>
            <p><strong>Adresse :</strong> {{ contrat.chantier.adresse_chantier }}</p>
            <p><strong>Surface :</strong> {{ contrat.chantier.surface_totale|default:"-" }} m¬≤</p>
            <p><strong>Type de b√¢timent :</strong> {{ contrat.chantier.get_type_batiment_display }}</p>
        </section>
        
        <section>
            <h3>D√âTAIL DES TRAVAUX DE D√âCORATION</h3>
            <p><strong>Nature des travaux :</strong> {{ contrat.chantier.description_detaille|default:"D√©coration non d√©taill√©e" }}</p>
            <p><strong>Surface √† d√©corer :</strong> {{ contrat.chantier.surface_totale|default:"Non sp√©cifi√©e" }} m¬≤</p>
        </section>
        
        <section>
            <h3>MAT√âRIAUX DE D√âCORATION</h3>
            <p><em>(√Ä titre indicatif)</em></p>
            <p>Les mat√©riaux utilis√©s seront de qualit√© conforme aux normes en vigueur.</p>
            <p>Les √©chantillons et coloris sont √† valider par le client avant r√©alisation.</p>
        </section>
        
        <section>
            <h3>CONDITIONS SP√âCIFIQUES</h3>
            <p>1. Le client devra lib√©rer les pi√®ces avant intervention.</p>
            <p>2. Les travaux de pr√©paration (rebouchage, lissage) sont inclus.</p>
            <p>3. Les finitions (peinture, papiers peints, etc.) sont garanties contre les d√©fauts d'application.</p>
            <p><strong>Garantie sp√©cifique :</strong> 24 mois sur les travaux de d√©coration</p>
        </section>

        <section>
            <h3>GARANTIE ET CLAUSES</h3>
            <p><strong>Garantie contractuelle :</strong> {{ contrat.garantie_mois }} mois</p>
            {% if contrat.notes_contractuelles %}
            <p><strong>Notes contractuelles :</strong> {{ contrat.notes_contractuelles }}</p>
            {% endif %}
        </section>
        
        <section>
            <h3>CONDITIONS FINANCI√àRES</h3>
            <p><strong>Montant total :</strong> {{ contrat.montant_total|floatformat:1|intcomma }} FCFA</p>
            <p><strong>Acompte :</strong> {{ contrat.acompte_pourcentage }}% √† la signature</p>
            <p><strong>Solde :</strong> √Ä la r√©ception des travaux</p>
            {% if contrat.mode_paiement == 'tranche' %}
            <p><strong>Mode de paiement :</strong> {{ contrat.get_mode_paiement_display }} ({{ contrat.nombre_tranches }} tranches)</p>
            {% endif %}
        </section>

        <section>
            <h3>√âTAT DES PAIEMENTS</h3>
            <p><strong>Montant d√©j√† encaiss√© :</strong> {{ contrat.montant_encaisse|floatformat:1|intcomma }} FCFA</p>
            <p><strong>Solde restant :</strong> {{ contrat.solde_restant|floatformat:1|intcomma }} FCFA</p>
            <p><strong>Pourcentage pay√© :</strong> {{ contrat.pourcentage_encaisse|floatformat:2 }}%</p>
            {% if contrat.date_du_dernier_paiement %}
            <p><strong>Dernier paiement :</strong> {{ contrat.date_du_dernier_paiement }}</p>
            {% endif %}

           <button onclick="openPaiementModal()" class="btn btn-success btn-sm">
  <svg style="width: 16px; height: 16px;" class="mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
  </svg>
  Nouveau paiement
</button>
        </section>
        
        <section>
            <h3>LIEU ET DATE DE SIGNATURE</h3>
            <p>Fait √† {{ contrat.chantier.ville_chantier|default:"Ouagadougou" }}, le {{ contrat.date_signature|default:"__________" }}</p>
        </section>
    </main>
    
    <footer>
        <h3 style="text-align: center; margin-bottom: 40px;">SIGNATURES</h3>
        <div class="signatures">
            <div class="signature-box">
                <div class="signature-line"></div>
                <p><strong>LE CLIENT</strong></p>
                <p>{{ contrat.chantier.client.nom_complet }}</p>
                <p style="margin-top: 20px;">Date : _________________</p>
            </div>
            
            <div class="signature-box">
                <div class="signature-line"></div>
                <p><strong>LE PRESTATAIRE</strong></p>
                <p>SANBA FinFlow - D√©coration</p>
                <p style="margin-top: 20px;">Date : _________________</p>
            </div>
        </div>
    </footer>
    
    <button onclick="window.print()" class="no-print">üñ®Ô∏è Imprimer ce contrat</button>

    {% include 'modal/enregistrer_paiement.html' %}
</body>
</html>