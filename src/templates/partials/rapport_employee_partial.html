      <!-- Vue Tableau -->
      {% load humanize %}
            <div id="tableView" class="table-container bg-white rounded-lg">
                <table class="table table-zebra w-full">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="font-bold text-gray-700">Employ√©</th>
                            <th class="font-bold text-gray-700">Type D√©pense</th>
                            <th class="font-bold text-gray-700">Chantier</th>
                            <th class="font-bold text-gray-700">Demande D√©caissement</th>
                            <th class="font-bold text-gray-700">Article</th>
                            <th class="font-bold text-gray-700 text-right">Prix Unitaire</th>
                            <th class="font-bold text-gray-700 text-right">Quantit√©</th>
                            <th class="font-bold text-gray-700 text-right">Total</th>
                            <th class="font-bold text-gray-700">Fournisseur</th>
                            <th class="font-bold text-gray-700">Facture</th>
                            <th class="font-bold text-gray-700">Statut</th>
                            <th class="font-bold text-gray-700 no-print">Actions</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for rapport in list_rapport_depense %}
                        <tr>
                            <!-- Employ√© -->
                            <td>
                                <div class="flex items-center">
                                    <div class="avatar placeholder mr-2">
                                        <div class="bg-blue-100 text-blue-800 rounded-full w-8 h-8 flex items-center justify-center font-semibold">
                                            {{ rapport.employee.username|first|upper }}
                                        </div>
                                    </div>
                                    <div>
                                        <div class="font-medium">{{ rapport.employee.username }}</div>
                                        <div class="text-xs text-gray-500">{{ rapport.date_creation|date:"d/m/Y" }}</div>
                                    </div>
                                </div>
                            </td>
                            
                            <!-- Type D√©pense -->
                            <td>
                                <span class="badge badge-outline badge-info">
                                    {{ rapport.type_depense|default:"-" }}
                                </span>
                            </td>
                           
                            <!-- Chantier -->
                            <td>
                                {% if rapport.chantier %}
                                    <span class="badge badge-success">
                                        {{ rapport.chantier|truncatechars:15 }}
                                    </span>
                                {% else %}
                                    <span class="text-gray-400 italic">-</span>
                                {% endif %}
                            </td>
                            
                            <!-- Demande D√©caissement -->
                            <td>
                                {% if rapport.demande_decaissement %}
                                    <div class="tooltip" data-tip="{{ rapport.demande_decaissement.motif|default:'' }}">
                                        <span class="font-mono text-sm">
                                            {{ rapport.demande_decaissement.reference_demande|default:"-" }}
                                        </span>
                                    </div>
                                {% else %}
                                    <span class="text-gray-400 italic">-</span>
                                {% endif %}
                            </td>
                            
                            <!-- Article -->
                            <td class="max-w-xs">
                                <div class="tooltip" data-tip="{{ rapport.materiau_article }}">
                                    {{ rapport.materiau_article|truncatechars:20|default:"-" }}
                                </div>
                            </td>
                            
                            <!-- Prix Unitaire -->
                            <td class="text-right font-semibold">
                                {{ rapport.prix_unitaire|floatformat:1|intcomma }} FCFA
                            </td>
                            
                            <!-- Quantit√© -->
                            <td class="text-right font-semibold">
                                {{ rapport.quantit√© }}
                            </td>
                            
                            <!-- Total -->
                            <td class="text-right">
                                <span class="font-bold text-green-600">
                                    {% widthratio rapport.prix_unitaire 1 rapport.quantit√© as total %}
                                    {{ total|floatformat:1|intcomma}} FCFA
                                </span>
                            </td>
                            
                            <!-- Fournisseur -->
                            <td>
                                {% if rapport.fournisseur %}
                                    <span class="badge badge-primary">
                                        {{ rapport.fournisseur.nom|truncatechars:15 }}
                                    </span>
                                {% elif rapport.fournisseur_not_db %}
                                    <div class="tooltip" data-tip="Nouveau fournisseur - √† ajouter en base">
                                        <span class="badge badge-warning">
                                            {{ rapport.fournisseur_not_db|truncatechars:15 }}
                                        </span>
                                        <br>
                                        <br>
                                        
                                <button onclick="document.getElementById('modalFournisseur').showModal()" class="btn btn-sm">
                                Ajouter fournisseur
                                </button>
                                {% include 'modal/modifier_rapport_fournisseur.html' %}
                                    </div>
                                {% else %}
                                    <span class="text-red-500 font-semibold">‚ùå Inconnu</span>
                                {% endif %}
                            </td>

                            <!-- Facture -->
                             <td>
                                {% if rapport.facture %}
                                <div class="flex items-center gap-2">
                                    <!-- Badge format -->
                                    <span class="badge badge-xs badge-outline">
                                        {{ rapport.facture.name|slice:"-3:"|upper }}
                                    </span>
                                    <!-- Actions -->
                                    <div class="flex gap-1">
                                        <button onclick="openFactureModal('{{ rapport.facture.url }}')"
                                                class="btn btn-ghost btn-xs">
                                            üëÅÔ∏è
                                        </button>
                                        <a href="{{ rapport.facture.url }}" 
                                        download
                                        class="btn btn-ghost btn-xs">
                                            ‚¨áÔ∏è
                                        </a>
                                    </div>
                                </div>
                                {% else %}
                                    <span class="text-red-500 font-semibold tooltip" data-tip="Pas de facture fournie">
                                        ‚ùå Sans facture
                                    </span>
                                {% endif %}
                            </td>        
                            <!-- Statut -->
                            <td>
                                {% if rapport.status == 'valide' %}
                                    <span class="status-badge status-valide">‚úÖ Valid√©</span>
                                {% elif rapport.status == 'rejete' %}
                                    <span class="status-badge status-rejete">‚ùå Rejet√©</span>
                                 {% elif rapport.status == 'modifier' %}   
                                     <span class="status-badge status-soumis ">üìÉ √† modiier</span>
                                {% else %}
                                    <span class="status-badge status-soumis">‚è≥ En attente</span>
                                {% endif %}
                            </td>
                
                            <!-- Actions -->
                            <td class="no-print">
                                <div class="flex gap-2">
                                     
                                <button onclick="document.getElementById('validationModal-{{ rapport.id }}').showModal()" class="btn btn-primary">
                                        Valider le rapport
                                        </button>
                                           
                                </div>
                                <!-- Modal -->
                                <dialog id="validationModal-{{ rapport.id }}" class="modal">
                                <div class="modal-box max-w-2xl">
                                    <!-- Header -->
                                    <div class="flex justify-between items-center mb-6 pb-4 border-b">
                                    <h3 class="text-xl font-bold">
                                        üìã Validation du rapport
                                    </h3>
                                    <form method="dialog">
                                        <button class="btn btn-sm btn-circle btn-ghost">‚úï</button>
                                    </form>
                                    </div>
                                    
                                    <!-- Informations du rapport -->
                                    <div class="p-4 rounded-lg mb-6">
                                    <div class="grid grid-cols-2 gap-3 text-sm">
                                        <div class="detail-row">
                                        <span class="font-semibold">Employ√© :</span>
                                        <span>{{ rapport.employee.username }}</span>
                                        </div>
                                        <div class="detail-row">
                                        <span class="font-semibold">Type :</span>
                                        <span>{{ rapport.type_depense.nom }}</span>
                                        </div>
                                        <div class="detail-row">
                                        <span class="font-semibold">Montant :</span>
                                        <span class="font-bold text-green-600">{{ rapport.total_affichage }}</span>
                                        </div>
                                        <div class="detail-row">
                                        <span class="font-semibold">Article :</span>
                                        <span>{{ rapport.materiau_article }}</span>
                                        </div>
                                    </div>
                                    </div>
                                    
                                    <!-- Formulaire -->
                                    <form method="post" action="{% url 'directeur_app:validation-rapports' rapport.pk %}">
                                    {% csrf_token %}
                                    
                                    <!-- Choix d'action -->
                                    <div class="mb-6">
                                        <label class="block font-semibold mb-3">Action :</label>
                                        <div class="space-y-3">
                                        {% for choice in validation_form.action %}
                                            <div class="flex items-center p-3 bg-base-200 rounded-lg hover:bg-base-300">
                                            {{ choice.tag }}
                                            <label for="{{ choice.id_for_label }}" class="ml-3 cursor-pointer">
                                                {{ choice.choice_label }}
                                            </label>
                                            </div>
                                        {% endfor %}
                                        </div>
                                    </div>
                                    
                                    <!-- Commentaire -->
                                    <div class="mb-6">
                                        <label class="block font-semibold mb-2">Commentaire :</label>
                                        {{ validation_form.commentaire_validation }}
                                    </div>
                                    
                                
                                        <button type="submit" class="btn btn-primary">
                                        Confirmer la d√©cision
                                        </button>
                                    </form>
                                </div>
                                
                                <!-- Fermeture en cliquant √† l'ext√©rieur -->
                                <form method="dialog" class="modal-backdrop">
                                    <button>close</button>
                                </form>
                                </dialog>
                            </td>
                        </tr>

                        {% empty %}
                        <tr>
                            <td colspan="12" class="text-center py-12">
                                <div class="flex flex-col items-center justify-center">
                                    <div class="text-6xl mb-4 text-gray-300">üì≠</div>
                                    <h3 class="text-xl font-semibold text-gray-500 mb-2">Aucun rapport trouv√©</h3>
                                    <p class="text-gray-400">Aucun employ√© n'a encore soumis de rapport</p>
                                </div>
                            </td>
                        </tr>

                        {% endfor %}
                    </tbody>
                   <tfoot>
                    <tr>
                        <th colspan="7" class="text-right font-bold">TOTAL G√âN√âRAL :</th>
                        <th id="totalGeneral" class="text-right font-bold text-green-700">
                            <!-- Calcul initial c√¥t√© serveur -->       
                            {{ total_general_depenses_filter|floatformat:1|intcomma }} FCFA     
                        </th>
                        <th colspan="4"></th>
                    </tr>
                </tfoot>
                </table>
            </div>    


<!-- JUSTE apr√®s ta table (√† la fin de ton template) -->
<dialog id="factureModal" class="modal">
    <div class="modal-box">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">‚úï</button>
        </form>
        <h3 class="font-bold text-lg mb-4">Facture</h3>
        <div id="modalContent"></div>
    </div>
    <form method="dialog" class="modal-backdrop"><button>Fermer</button></form>
</dialog>

<script>
function openFactureModal(fileUrl) {
    const modal = document.getElementById('factureModal');
    const content = document.getElementById('modalContent');
    const ext = fileUrl.split('.').pop().toLowerCase();
    
    if (['jpg','jpeg','png','gif'].includes(ext)) {
        content.innerHTML = `<img src="${fileUrl}" class="w-full rounded">`;
    } else if (ext === 'pdf') {
        content.innerHTML = `<iframe src="${fileUrl}" class="w-full h-96"></iframe>`;
    } else {
        content.innerHTML = `<a href="${fileUrl}" download class="btn btn-primary">T√©l√©charger (${ext})</a>`;
    }
    
    modal.showModal();
}
</script>  